<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>SUPPORT HP Timing Heal</title>

  <style>
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0b0b12; color:#fff; display:flex; justify-content:center; }
.wrap { width:min(520px, 92vw); padding:24px; }
h1 { margin:0 0 12px; font-size:22px; }
.card { background:#141427; border:1px solid #2a2a4a; border-radius:18px; padding:18px; }
.row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
.barBox { margin:14px 0 10px; background:#0f0f1e; border:1px solid #2a2a4a; border-radius:14px; padding:12px; }
.bar { height:22px; background:#22223a; border-radius:999px; overflow:hidden; }
.fill { height:100%; width:100%; background:linear-gradient(90deg,#ff3b3b,#ff9f1a); transition:width 50ms linear; }
.meta { display:flex; justify-content:space-between; font-size:13px; opacity:.9; margin-top:10px; gap:12px; flex-wrap:wrap; }
button { cursor:pointer; border:none; border-radius:14px; padding:14px 16px; font-weight:700; font-size:16px; }
.start { background:#7c3aed; color:#fff; }
.heal { background:#22c55e; color:#04140a; flex:1; min-width:160px; }
.heal:disabled { opacity:.45; cursor:not-allowed; }
.pill { font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid #2a2a4a; background:#0f0f1e; }
.msg { margin-top:12px; font-size:16px; line-height:1.5; }
.hint { margin-top:10px; font-size:12px; opacity:.8; }
.good { color:#7CFFB2; }
.bad { color:#ff7b7b; }
.msg { white-space: pre-line; } /* ì¤„ë°”ê¿ˆ í‘œì‹œ */  </style>
</head>
<body>

 <div class="wrap">
  <h1>ğŸª„ SUPPORT / â¤ï¸ HP ë°” íƒ€ì´ë° í</h1>

  <div class="card">
    <div class="row">
      <span class="pill">ì‹œê°„: <b id="timeLeft">3.00</b>s</span>
      <span class="pill">ëª©í‘œ êµ¬ê°„: <b id="windowTxt">28~32</b> HP</span>
      <span class="pill">í˜„ì¬ HP: <b id="hpTxt">100</b></span>
    </div>

    <div class="barBox">
      <div class="bar"><div class="fill" id="fill"></div></div>
      <div class="meta">
        <span>í•µì‹¬: íƒ€ì´ë°</span>
        <span>ë°©ë²•: HP ì¤„ì–´ë“¤ ë•Œ ë”± ë§ì¶° ë²„íŠ¼ 1ë²ˆ</span>
      </div>
    </div>

    <div class="row">
      <button class="start" id="startBtn">START</button>
      <button class="heal" id="healBtn" disabled>HEAL (ìŠ¤í˜ì´ìŠ¤ë°”)</button>
    </div>

    <div class="row" style="margin-top:10px;">
  <span class="pill">ë¼ìš´ë“œ: <b id="roundTxt">0</b>/5</span>
  <span class="pill">ì„±ê³µ: <b id="winTxt">0</b></span>
  <span class="pill">ì‹¤íŒ¨: <b id="loseTxt">0</b></span>
</div>

    <div class="msg" id="msg">ì‹œì‘ì„ ëˆ„ë¥´ê³ , HPê°€ ëª©í‘œ êµ¬ê°„ì— ë“¤ì–´ì˜¤ë©´ í!</div>
    <div class="hint">íŒ: ì ë‹¹í•œ íƒ€ì´ë°ì— íì„ ì£¼ëŠ”ê²Œ í¬ì¸íŠ¸! ğŸ”¥</div>
  </div>
</div>


<script>
(() => {
  // íŠœë‹ í¬ì¸íŠ¸
  const DURATION = 3.0;          // ì œí•œì‹œê°„(ì´ˆ)
  const START_HP = 100;
  const DRAIN_PER_SEC = 45;      // ğŸ”¥ ì†ë„(ì›í•˜ë©´ ì—¬ê¸° ë” ì˜¬ë ¤)
  const SUCCESS_MIN = 28;
  const SUCCESS_MAX = 32;

  const TOTAL_ROUNDS = 5;        // âœ… 5íŒ ê³ ì •
  const AUTO_NEXT_DELAY = 1200;  // ë‹¤ìŒ ë¼ìš´ë“œ ìë™ ì‹œì‘(ms)
  const SHOW_RESULT_DELAY = 2000;// ìµœì¢… ê²°ê³¼ í™”ë©´ ëŒ€ê¸°(ms)

  // ìƒíƒœ
  let running = false;
  let usedHeal = false;
  let t0 = 0;
  let rafId = 0;

  let round = 0;
  let win = 0;
  let lose = 0;

  const el = {
    timeLeft: document.getElementById('timeLeft'),
    windowTxt: document.getElementById('windowTxt'),
    hpTxt: document.getElementById('hpTxt'),
    fill: document.getElementById('fill'),
    msg: document.getElementById('msg'),
    startBtn: document.getElementById('startBtn'),
    healBtn: document.getElementById('healBtn'),
    roundTxt: document.getElementById('roundTxt'),
    winTxt: document.getElementById('winTxt'),
    loseTxt: document.getElementById('loseTxt'),
  };

  el.windowTxt.textContent = `${SUCCESS_MIN}~${SUCCESS_MAX}`;

  function setMsg(text, cls) {
    el.msg.classList.remove('good','bad');
    if (cls) el.msg.classList.add(cls);
    el.msg.textContent = text;
  }

  function updateScoreUI() {
    el.roundTxt.textContent = round;
    el.winTxt.textContent = win;
    el.loseTxt.textContent = lose;
  }

  function hpAt(timeSec) {
    const hp = START_HP - (DRAIN_PER_SEC * timeSec);
    return Math.max(0, Math.min(START_HP, hp));
  }

  function render(timeSec) {
    const hp = hpAt(timeSec);
    el.hpTxt.textContent = Math.round(hp);
    el.fill.style.width = `${(hp / START_HP) * 100}%`;

    const left = Math.max(0, DURATION - timeSec);
    el.timeLeft.textContent = left.toFixed(2);
  }

  function stopLoop() {
    cancelAnimationFrame(rafId);
    rafId = 0;
  }

  function endRound(result, extraText = "") {
    // result: "win" | "lose"
    running = false;
    stopLoop();
    el.healBtn.disabled = true;
    el.startBtn.disabled = true; // ë¼ìš´ë“œ ì§„í–‰ ì¤‘ì—” ìˆ˜ë™ ì‹œì‘ ë§‰ê¸°

    if (result === "win") {
      win++;
      setMsg(`âœ… PERFECT HEAL! â€œì„œí¿ì€ ì‚´ë¦¬ëŠ” ìˆœê°„ì„ ì•ˆë‹¤â€ ${extraText}`, "good");
    } else {
      lose++;
      setMsg(`âŒ MISSâ€¦ ${extraText}`, "bad");
    }

    updateScoreUI();

    if (round >= TOTAL_ROUNDS) {
      // ìµœì¢… ê²°ê³¼ í™”ë©´
      setTimeout(showFinalResult, SHOW_RESULT_DELAY);
    } else {
      // ë‹¤ìŒ ë¼ìš´ë“œ ìë™ ì‹œì‘
      setTimeout(startRound, AUTO_NEXT_DELAY);
    }
  }

  function showFinalResult() {
    el.startBtn.disabled = false;
    el.startBtn.textContent = "RETRY (5íŒ)";
    const grade =
      win === 5 ? "ğŸ‘‘ ì±Œë¦°ì €" :
      win >= 4 ? "ğŸ§¡ ê·¸ëœë“œë§ˆìŠ¤í„°" :
      win >= 3 ? "ğŸ’œ ë§ˆìŠ¤í„°" :
      win >= 2 ? "ğŸ©µ ë‹¤ì´ì•„" :
      win >= 2 ? "ğŸ’š Platinum" :
      "ğŸ’” UNRANK....";

    setMsg(`ğŸ 5íŒ ì¢…ë£Œ!\nì„±ê³µ ${win} / ì‹¤íŒ¨ ${lose}\në“±ê¸‰: ${grade}`, null);
  }

  function startMatch() {
    // 5íŒ ìƒˆë¡œ ì‹œì‘
    round = 0; win = 0; lose = 0;
    el.startBtn.textContent = "START";
    updateScoreUI();
    startRound();
  }

  function startRound() {
    usedHeal = false;
    running = true;
    round++;
    updateScoreUI();

    t0 = performance.now();
    el.startBtn.disabled = true;
    el.healBtn.disabled = false;

    setMsg(`Round ${round}/${TOTAL_ROUNDS} ì‹œì‘! ëª©í‘œ êµ¬ê°„ì—ì„œ HEAL!`, null);

    const loop = () => {
      const elapsed = (performance.now() - t0) / 1000;
      render(elapsed);

      if (elapsed >= DURATION) {
        // ì‹œê°„ ì´ˆê³¼ = ì‹¤íŒ¨
        endRound("lose", "(ì‹œê°„ ë)");
        return;
      }
      rafId = requestAnimationFrame(loop);
    };
    rafId = requestAnimationFrame(loop);
  }

  function heal() {
    if (!running || usedHeal) return;
    usedHeal = true;

    const elapsed = (performance.now() - t0) / 1000;
    const hp = hpAt(elapsed);

    // íŒì •
    if (hp >= SUCCESS_MIN && hp <= SUCCESS_MAX) {
      endRound("win", `(ëˆ„ë¥¸ HP: ${Math.round(hp)})`);
    } else {
      endRound("lose", `(ëˆ„ë¥¸ HP: ${Math.round(hp)})`);
    }
  }

  // ë²„íŠ¼ ì´ë²¤íŠ¸
  el.startBtn.addEventListener('click', () => {
    if (el.startBtn.textContent.startsWith("RETRY")) startMatch();
    else startMatch(); // ì²˜ìŒë„ 5íŒ ë§¤ì¹˜ ì‹œì‘
  });

  el.healBtn.addEventListener('click', heal);

  // ìŠ¤í˜ì´ìŠ¤ë°”: ì§„í–‰ ì¤‘ì´ë©´ í, ëŒ€ê¸° ì¤‘ì´ë©´ ì‹œì‘
  window.addEventListener('keydown', (e) => {
    if (e.code === 'Space') {
      e.preventDefault();
      if (running) heal();
      else if (!el.startBtn.disabled) startMatch();
    }
  });

  // ì´ˆê¸° í‘œì‹œ
  updateScoreUI();
  render(0);
})();
</script>

</body>
</html>
